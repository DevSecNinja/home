services:
  vidaud:
    container_name: vidaud
    image: >-
      ghcr.io/devsecninja/vidaud:0.1.1@sha256:40c45608b06d255303dc458e6dadef45ca2e23c151941c66a351ef4a850d2111
    depends_on:
      - traefik
    networks:
      - vidaud-frontend
    restart: always
    security_opt:
      - no-new-privileges=true
    mem_limit: 2048m  # Higher limit for video processing
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      # TODO: Configure vidaud-specific environment variables as needed:
      # - INPUT_DIR=/media/input    # Directory to monitor for video files
      # - OUTPUT_DIR=/media/output  # Directory for converted audio files
      # - OUTPUT_FORMAT=mp3         # Default audio format (mp3/flac)
      # - QUALITY=high              # Audio quality setting
      # - PRESERVE_METADATA=true    # Keep original metadata
      # - PLEX_COMPATIBLE=true      # Ensure Plex compatibility
    volumes:
      # TODO: Configure volume mounts for media processing:
      # - ${USERDIR}/media/videos:/media/input:ro  # Input directory (read-only)
      # - ${USERDIR}/media/audio:/media/output:rw  # Output directory
      # - vidaud_config:/app/config                # Configuration persistence
      # Optional: For hardware acceleration (if supported):
      # - /dev/dri:/dev/dri                        # Intel QuickSync
    # Optional: Hardware acceleration (uncomment if GPU needed)
    # devices:
    #   - /dev/dri:/dev/dri                        # Intel GPU
    # Optional: Runtime for GPU support (uncomment if NVIDIA GPU needed)
    # runtime: nvidia
    # Optional: Environment for GPU support
    # environment:
    #   - NVIDIA_VISIBLE_DEVICES=all
    labels:
      # Homepage
      - homepage.group=Media
      - homepage.name=Vidaud
      - homepage.icon=mdi-file-video
      - homepage.href=https://vidaud.$DOMAINNAME
      - homepage.description=Video to Audio Converter
      # Traefik
      - "traefik.enable=true"
      - "traefik.docker.network=vidaud-frontend"
      ## Middlewares
      - "traefik.http.routers.vidaud-rtr.middlewares=chain-auth@file"
      ## HTTP Services
      - "traefik.http.routers.vidaud-rtr.service=vidaud-svc"
      - "traefik.http.services.vidaud-svc.loadbalancer.server.port=8080"

networks:
  vidaud-frontend:
    name: vidaud-frontend

# Optional: Uncomment if using named volumes
# volumes:
#   vidaud_config:
