services:
  samba:
    container_name: samba
    # TODO: [samba] Replace old Samba container
    image: dperson/samba:amd64@sha256:e1d2a7366690749a7be06f72bdbf6a5a7d15726fc84e4e4f41e967214516edfd
    restart: always
    networks:
      - samba
    ports:
      - "445:445/tcp"
    mem_limit: 1024m
    security_opt:
      - no-new-privileges:true
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - USERID=${PUID}
      - GROUPID=${PGID}
      - TZ=${TZ}
    volumes:
      - $DOCKERDATADIR:/data
      - $DOCKERARCHIVEDIR:/archive
      # Paperless
      - $DOCKERDIR/data/paperless-ngx:/docker/data/paperless-ngx
      - paperless_media_data:/docker/data/docs:ro
    # -r = disable recycle bin
    # -p = set ownership and permissions on the shares
    command: >
      -s "Archive;/archive;yes;no;no;${SAMBA_USERNAME}"
      -s "Backup;/archive/backup;yes;no;no;${SAMBA_USERNAME}"
      -s "Data;/data;yes;no;no;${SAMBA_USERNAME}"
      -s "Docs;/docker/data/docs/documents/originals;yes;no;no;${SAMBA_USERNAME}"
      -s "Paperless;/docker/data/paperless-ngx;yes;no;no;${SAMBA_USERNAME}"
      -s "Study;/data/media/study;yes;no;no;${SAMBA_USERNAME}"
      -u "${SAMBA_USERNAME};${SAMBA_PASSWORD}"
      -p
      -r

networks:
  samba:
    name: samba
    driver: bridge
